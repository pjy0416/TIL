## 컴퓨터시스템의 구조

- ![image](https://user-images.githubusercontent.com/40550453/98442671-50641e80-2149-11eb-843d-607644595823.png)

- CPU
  - 매 클럭 시간마다 인스트럭션(명령)해서 메모리에서 하나씩 읽어온다.
  - 또한, 매 클럭 시간마다 interrupt line을 체크한다.
- Memory
  - CPU의 작업 공간
- DISK
  - Input / output 역할을 동시에 한다.
  - 입력받은 것들을 전달하거나, 작업이 끝난 것을 저장하는 등

- interrupt line

  - CPU가 프로그램을 실행하고 있을 때, IO나 Exception이 발생하여 처리가 필요한 경우 CPU에게 알려서 처리할 수 있도록 하는 역할
  - `interrupt = 새치기`
  - time sharing 구현에 널리 사용됨

- timer

  - 특정 프로그램이 CPU를 독점하는 것을 막기 위해, timer에 값을 셋팅해서 CPU를 넘김
  - 할당 시간을 관장한다고 생각하면 된다.

- mode bit

  - mode bit이 0일 때는 cpu에서 넘겨주면서 1로 바꾸고, 1일 때는 접근을 제어한다.

- Device Controller

  - IO 장치를 전담하는 일종의 작은 CPU라고 생각하면 됨
  - 제어 정보를 위한 control register, status register가 존재
  - local buffer를 가지고 있음 (data register라고 생각하면 된다)

- DMA Controller

  - IO 입출력에서 넘어온 것을 DMA가 memory에 직접 복사 및 Interrupt line으로 들어온 명령 추가
    - cpu가 직접 IO 명령을 받아서 메모리에 저장하는게 오버헤드가 크기 때문에
  - memory controller
    - CPU와 DMA controller가 동시에 memory에 접근할 수 있어서 순서를 제어

- IO의 수행

  - 시스템 콜(system call)
    - (메모리에 올라간)사용자 프로그램이(프로세스가) OS에게 IO 요청
    - 프로세스가 직접 Interrupt를 걸어서 사용
  - trap을 이용해서 인터럽트 벡터의 특정 위치로 이동

- 인터럽트 (Interrupt)

  - 인터럽트 당한 시점의 레지스터와 program counter를 저장한 후 CPU 제어를 인터럽트 처리 루틴에 넘긴다.
  - 넓은 의미
    - Interrupt(하드웨어 인터럽트)
      - 하드웨어가 발생시킨 인터럽트
    - Trap (소프트웨어 인터럽트)
      - Exception : 프로그램이 오류 발생
      - System call : 프로그램이 커널 함수를 호출
  - 인터럽트 벡터
    - 해당 인터럽트의 처리 루틴 주소를 가지고 있음

  - 인터럽트 처리 루틴 ( = Interrupt Service Routine, 인터럽트 핸들러)
    - 해당 인터럽트를 처리하는 커널 함수

- 레지스터(register)
  - CPU가 현재 처리하고있는 데이터를 보유
  - CPU가 현재 처리중인 피연산자 or 명령어를 보유
  - PC(Program counter)
    - 실행해야하는 명령의 주소를 가리킴
  - 명령 레지스터
    - 명령어를 잠시 보관해두는 특수 목적 레지스터 (명령어가 쌓인다고 생각하면 된다)

- 동기식 입출력과 비동기식 입출력

  - 동기식 입출력 (synchronous IO)
    - IO 요청 후 입출력 작업이 완료된 후에야 제어가 사용자 프로그램에 넘어감
  - 비동기식 입출력 (asynchronous IO)
    - IO 시작된 후 입출력 작업이 끝나기를 기다리지 않고 제어가 사용자 프로그램에 즉시 넘어감
  - 두 경우 모두 IO 완료는 인터럽트로 알려준다.

- Memory mapped IO

  - 메모리에 IO를 관장하는 주소를 탑재해놓고, 이 주소로 들어오면 실행을 하게끔
  - 일반적인 IO는 Memory 주소 공간과 Device 공간(IO 관련)을 따로 둔다

- 저장장치 계층 구조

  - ![image](https://user-images.githubusercontent.com/40550453/98443963-324eec00-2152-11eb-8538-b701e56ef8be.png)
  - 초록색 계층은 주로 휘발성, 분홍색 계층은 비휘발성 특징을 가지고 있음

- 프로그램의 실행 (메모리 load)

  - ![image](https://user-images.githubusercontent.com/40550453/98444033-b99c5f80-2152-11eb-9ac8-506b93fa8208.png)
  - 프로세스는 파일시스템에 저장되어 있는 실행파일이 메모리에 저장되어 CPU에서 실행되는 프로그램
    - 메모리 공간에는 스택, 데이터, 코드 영역(여기 까지가 주소공간), 힙 영역으로 나눌 수 있음

- 커널 주소 공간의 내용

  - ![image](https://user-images.githubusercontent.com/40550453/98444146-70004480-2153-11eb-8786-99bc7e129648.png)

    



출처 : [kocw 강의](http://www.kocw.net/home/search/kemView.do?kemId=1046323)